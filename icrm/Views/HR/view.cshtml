@using icrm.Models
@model icrm.Models.Feedback

@{
    Layout = null;
}


@{
    var data = (ApplicationUser)ViewData["user"];



}
<!DOCTYPE html>
<html lang="en">
<head>
    <!-- Required meta tags -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

    <!-- Meta -->
    <meta name="description" content="feedback managment system.">
    <meta name="author" content="feedback">
    <title>Create Tickets</title>
    <!-- vendor css -->
    <link href="https://stackpath.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css" rel="stylesheet" integrity="sha384-wvfXpqpZZVQGK6TAh5PVlGOfQNHSoD2xbE+QkPxCAFlNEevoEH3Sl0sibVcOQVnN" crossorigin="anonymous">
    <link rel="stylesheet" href="http://code.ionicframework.com/ionicons/2.0.1/css/ionicons.min.css" />
    <link href="~/Content/lib/jquery-toggles/css/toggles-full.css" rel="stylesheet">
    <link href="~/Content/lib/jt.timepicker/css/jquery.timepicker.css" rel="stylesheet">
    <link href="~/Content/lib/spectrum/css/spectrum.css" rel="stylesheet">
    <link href="~/Content/lib/bootstrap-tagsinput/css/bootstrap-tagsinput.css" rel="stylesheet">
    <!-- Feadback CSS -->
    <link rel="stylesheet" href="~/Content/css/slim.css">
</head>
<body>
    @Html.Partial("_HRMenu")
    <!-- slim-navbar -->
    <div class="slim-mainpanel">
        <div class="container">
            <div class="slim-pageheader">
                <ol class="breadcrumb slim-breadcrumb">
                    <li class="breadcrumb-item"><a href="#">Home</a></li>
                    <li class="breadcrumb-item active" aria-current="page">Create Tickets</li>
                </ol>
                <h6 class="slim-pagetitle">CREATE TICKET</h6>
            </div>
            <!-- slim-pageheader -->
            @Html.ValidationSummary()
            @using (Html.BeginForm("assign", "HR", FormMethod.Post, new { @class = "form-horizontal", role = "form" }))
            {

                @Html.AntiForgeryToken()
                <div class="section-wrapper">
                    <label class="section-title">CREATING TICKETS BY HR</label>

                    <p class="mg-b-20 mg-sm-b-40"></p>
                    <div class="form-layout">
                        <span class="tx-danger">@TempData["Message"]</span>
                        <span class="tx-success">@TempData["MessageSuccess"]</span>
                        @Html.HiddenFor(model => model.id, new { @class = "form-control" })
                        @Html.HiddenFor(model => model.userId, new { @class = "form-control" })
                        @Html.HiddenFor(model => model.user.LastName, new { @class = "form-control" })
                        @Html.HiddenFor(model => model.assignedBy, new { @class = "form-control" })
                        @Html.HiddenFor(model => model.assignedDate, new { @class = "form-control" })
                        @Html.HiddenFor(model => model.closedDate, new { @class = "form-control" })
                        @Html.HiddenFor(model => model.satisfaction, new { @class = "form-control" })



                        @Html.HiddenFor(model => model.submittedById, new { @class = "form-control" })


                        <div class="row mg-b-25">
                            <div class="col-lg-4">
                                <div class="form-group">
                                    <label class="form-control-label">Name: <span class="tx-danger">*</span></label>
                                    @Html.TextBoxFor(model => model.user.FirstName, new { @readonly = "readonly", @class = "form-control" })
                                </div>
                            </div>
                            <!-- col-4 -->
                            <div class="col-lg-4">
                                <div class="form-group">
                                    <label class="form-control-label">Badge No: <span class="tx-danger">*</span></label>
                                    @Html.TextBoxFor(model => model.user.EmployeeId, new { @readonly = "readonly", @class = "form-control" })
                                </div>
                            </div>
                            <!-- col-4 -->
                            <div class="col-lg-4">
                                <div class="form-group">
                                    <label class="form-control-label">Email: <span class="tx-danger">*</span></label>
                                    @Html.TextBoxFor(model => model.user.Email, new { @readonly = "readonly", @class = "form-control" })
                                </div>
                            </div>
                            <div class="col-lg-4">
                                <div class="form-group">
                                    <label class="form-control-label">Phone No: <span class="tx-danger">*</span></label>
                                    @Html.TextBoxFor(model => model.user.PhoneNumber, new { @readonly = "readonly", @class = "form-control" })
                                </div>
                            </div>
                            <!-- col-4 -->
                            <div class="col-lg-4">
                                <div class="form-group">
                                    <label class="form-control-label">Location: <span class="tx-danger">*</span></label>
                                    @Html.TextBoxFor(model => model.user.Location.name, new { @readonly = "readonly", @class = "form-control" })

                                </div>
                            </div>
                            <!-- col-4 -->
                            <div class="col-lg-4">
                                <div class="form-group">
                                    <label class="form-control-label">Sub Location: <span class="tx-danger">*</span></label>
                                    @Html.TextBoxFor(model => model.user.SubLocation.name, new { @readonly = "readonly", @class = "form-control" })

                                </div>
                            </div>

                            <!-- col-4 -->
                            <!-- col-4 -->
                            <div class="col-lg-4">
                                <div class="form-group">
                                    <label class="form-control-label">JobTitle: <span class="tx-danger">*</span></label>
                                    @Html.TextBoxFor(model => model.user.JobTitle.name, new { @readonly = "readonly", @class = "form-control" })

                                </div>
                            </div>
                            <!-- col-4 -->
                            <div class="col-lg-4">
                                <div class="form-group">
                                    <label class="form-control-label">Nationality: <span class="tx-danger">*</span></label>
                                    @Html.TextBoxFor(model => model.user.Nationality.name, new { @readonly = "readonly", @class = "form-control" })

                                </div>
                            </div>
                            <!-- col-4 -->
                            <!-- col-4 -->
                        </div>
                        <!-- row -->
                        <!-- form-layout-footer -->

                    </div>

                    <label class="section-title">FeedBack / Complaint</label>


                    <div class="form-layout">
                        <div class="row mg-b-25">
                            <div class="col-lg-4">
                                <div class="form-group">
                                    <label class="form-control-label">Type: <span class="tx-danger">*</span></label>
                                    @Html.TextBox("typeoffeedback", Model.type.name, new { @readonly = "readonly", @class = "form-control" })
                                    @Html.HiddenFor(model => model.typeId, new { @readonly = "readonly", @class = "form-control" })
                                </div>
                            </div>
                            <div class="col-lg-4">
                                <div class="form-group">
                                    <label class="form-control-label">Title: <span class="tx-danger">*</span></label>
                                    @Html.TextBoxFor(model => model.title, new { @readonly = "readonly", @class = "form-control" })
                                </div>
                            </div>
                            <!-- col-4 -->
                            <div class="col-lg-4">
                                <div class="form-group mg-b-10-force">
                                    <label class="form-control-label">Description: <span class="tx-danger">*</span></label>
                                    @Html.TextAreaFor(model => model.description, new { @readonly = "readonly", @class = "form-control" })
                                </div>
                            </div>

                            @if (Model.departmentID != null)
                            {
                                <!-- col-4 -->
                                <div class="col-lg-4">
                                    <div class="form-group">
                                        <label class="form-control-label">Department: <span class="tx-danger">*</span></label>
                                        @Html.DropDownListFor(m => m.departmentID,
                              new SelectList(ViewBag.Departmn,
                            "Id", "name"), "Choose Department", new { disabled="disabled", @class = "form-control select2",id= "deptId" })
                                        @Html.HiddenFor(model => model.departmentID, new { @class = "form-control" })
                                    </div>
                                </div>
                            }
                            else

                            {
                                <!-- col-4 -->
                                <div class="col-lg-4">
                                    <div class="form-group">
                                        <label class="form-control-label">Department: <span class="tx-danger">*</span></label>
                                        @Html.DropDownListFor(m => m.departmentID,
                              new SelectList(ViewBag.Departmn,
                            "Id", "name"), "Choose Department", new { @class = "form-control select2",id= "deptId" })
                                    </div>
                                </div>
                            }


                            @if (Model.categoryId == null)
                            {
                                <div class="col-lg-4">
                                    <div class="form-group">
                                        <label class="form-control-label">Category: <span class="tx-danger">*</span></label>
                                        <select id="category" class="form-control select2" name="categoryId">
                                            <option value="">Choose Category</option>

                                        </select>

                                    </div>
                                </div>

                            }
                            else
                            {
                                <!-- col-4 -->
                                        <div class="col-lg-4">
                                            <div class="form-group">
                                                <label class="form-control-label">Category: <span class="tx-danger">*</span></label>
                                                <select id="category" class="form-control select2" name="categoryId" disabled="disabled">
                                                    <option value="">Choose Category</option>

                                                </select>

                                            </div>
                                        </div>
                                        @Html.HiddenFor(model => model.categoryId, new { @class = "form-control" })
                                    
                            }




                            @if (Model.subcategoryId == null)
                                        {
                                <div class="col-lg-4">
                                    <div class="form-group">
                                        <label class="form-control-label">Sub Category: <span class="tx-danger">*</span></label>
                                        <select id="subcategory" class="form-control select2" name="subcategoryId">
                                            <option value="">Choose Sub Category</option>

                                        </select>

                                    </div>
                                </div>

                            }
                            else
                            {
                                <!-- col-4 -->
                                        <div class="col-lg-4">
                                            <div class="form-group">
                                                <label class="form-control-label"> Sub Category: <span class="tx-danger">*</span></label>
                                                <select id="subcategory" class="form-control select2" name="subcategoryId" disabled="disabled">
                                                    <option value="">Choose Sub Category</option>

                                                </select>

                                            </div>
                                        </div>
                                        @Html.HiddenFor(model => model.subcategoryId, new { @class = "form-control" })
                                   
                                
                            }







                            @if (Model.priorityId == null)
                                        {
                                <div class="col-lg-4">
                                    <div class="form-group">
                                        <label class="form-control-label">Priority: <span class="tx-danger">*</span></label>
                                        @Html.DropDownListFor(m => m.priorityId,
                   new SelectList(ViewBag.Priorities,
                 "Id", "priorityId"), "Choose Priority", new { @class = "form-control select2", id = "priorty" })
                                    </div>
                                </div>
                            }
                            else
                            {
                                <div class="col-lg-4">
                                    <div class="form-group">
                                        <label class="form-control-label">Priority: <span class="tx-danger">*</span></label>
                                        @Html.DropDownListFor(m => m.priorityId,
                   new SelectList(ViewBag.Priorities,
                 "Id", "priorityId"), "Choose Priority", new { disabled="disabled", @class = "form-control select2", id = "priorty" })
                                        @Html.HiddenFor(model => model.priorityId, new { @class = "form-control" })

                                    </div>
                                </div>
                            }
                            <!-- col-4 -->
                        </div>
                            
                        <!-- row -->
                        <!-- form-layout-footer -->
                    </div>



                    <label class="section-title">Attachment</label>

                  
                    <div class="form-layout">
                        <div class="row mg-b-25">
                            @if (Model.attachment != null)
                                        {
                                <div class="col-lg-4">
                                    <div class="form-group">
                                        <label class="form-control-label">Download</label>
                                        @Html.HiddenFor(m => m.attachment)
                                        <a href="@Url.Action("DownloadFile", "HR", new { filename = Model.attachment })" target="_blank" style="height:200px;width:200px;"><i class="fa fa-download"></i></a>

                                    </div>
                                </div>
                                <!-- col-4 -->
                            }

                            </div>

                        <div class="row mg-b-25">
                            @if (Model.departmentID == null)
                                        {
                                <div class="col-lg-4">
                                    <div class="form-group">
                                        <label class="form-control-label">Choose Action</label>
                                        <select name="status" id="statusfield" class="form-control select2">

                                            @if (Model.status == "Open")
                                        {
                                                <option selected value="Open">Open</option>
                                                <option value="Resolved">Resolved</option>
                                                <option value="Closed">Closed</option>
                                            }
                                            else if (Model.status == "Closed")
                                            {
                                                <option value="Open">Open</option>
                                                <option value="Resolved">Resolved</option>
                                                <option selected value="Closed">Closed</option>
                                            }
                                            else
                                            {

                                                <option value="Open">Open</option>
                                                <option selected value="Resolved">Resolved</option>
                                                <option value="Closed">Closed</option>
                                            }


                                        </select>
                                    </div>
                                    <label class="text-danger" id="statuscheck"></label>
                                </div>
                            }
                            else
                            {

                                <div class="col-lg-4">
                                    <div class="form-group">
                                        <label class="form-control-label">Choose Action</label>
                                        <select name="status" id="statusfield" class="form-control select2">

                                            @if (Model.status == "Open")
                                        {
                                                <option selected value="Open">Open</option>
                                                <option value="Closed">Closed</option>
                                            }
                                            else if (Model.status == "Closed")
                                            {
                                                <option value="Open">Open</option>
                                                <option selected value="Closed">Closed</option>
                                            }
                                           


                                        </select>
                                    </div>
                                  <label class="text-danger" id="statuscheck"></label>
                                </div>
                            }
                           
                            @if (Model.departmentID != null)
                                        {


                                <!-- col-4 -->
                                <div class="col-lg-4">
                                    <div class="form-group">
                                        <label class="form-control-label">Comment</label>
                                        @Html.TextArea("responsee", new { @class = "form-control", name = "responsee", @readonly = "readonly" })

                                        @*  @Html.HiddenFor(model => model.responseById, new { @class = "form-control" })
                    @Html.HiddenFor(model => model.responseDate, new { @class = "form-control" })
                    @Html.HiddenFor(model => model.response, new { @class = "form-control" })*@
                                    </div>
                                </div>

                            }
                            else
                            {


                                <!-- col-4 -->
                                <div class="col-lg-4">
                                    <div class="form-group">
                                        <label class="form-control-label">Comment</label>
                                        @Html.TextArea("responsee", new { @class = "form-control", name = "responsee" })


                                    </div>
                                </div>

                            }
                        </div>

                        @if (Model.departmentID == null)
                        {
                            <!-- row -->
                        <div class="form-layout-footer">
                            <input type="submit" value="Forward" name="submitButton" id="forward" class="btn btn-primary bd-0" />
                            <input type="submit" value="Resolve" name="submitButton" id="resolve" class="btn btn-primary bd-0" />
                            <input type="submit" value="Reject" name="submitButton" id="rejected" class="btn btn-secondary bd-0" />
                        </div>
                        }else
                        {
                            <!-- row -->
                            <div class="form-layout-footer">
                                <input type="submit" value="Forward" name="submitButton" id="forward2" class="btn btn-primary bd-0" />
                               
                            </div>
                        }
                        <!-- form-layout-footer -->
                    </div>

                </div>
            }
            <!-- container -->
        </div>
        </div>
        <!-- slim-mainpanel -->
        <div class="slim-footer">
            <div class="container">
                <p>Copyright 2018 &copy; All Rights Reserved. </p>
            </div>
            <!-- container -->
        </div>
        <!-- slim-footer -->
        <script src="~/Content/lib/jquery/js/jquery.js"></script>
        <script src="~/Content/lib/popper.js/js/popper.js"></script>
        <script src="~/Content/lib/bootstrap/js/bootstrap.js"></script>
        <script src="~/Content/lib/jquery.cookie/js/jquery.cookie.js"></script>
        <script src="~/Content/lib/moment/js/moment.js"></script>
        <script src="~/Content/lib/jquery-ui/js/jquery-ui.js"></script>
        <script src="~/Content/lib/jquery-toggles/js/toggles.min.js"></script>
        <script src="~/Content/lib/jt.timepicker/js/jquery.timepicker.js"></script>
        <script src="~/Content/lib/spectrum/js/spectrum.js"></script>
        <script src="~/Content/lib/jquery.maskedinput/js/jquery.maskedinput.js"></script>
        <script src="~/Content/lib/bootstrap-tagsinput/js/bootstrap-tagsinput.js"></script>
        <script src="~/Content/js/slim.js"></script>
        <script>

            
            $('#rejected').click(function () {
                
                if ($('#statusfield').val() == "Resolved" || res) {
                    $('#statuscheck').text("Set status either Open/Closed");
                    return false;
                }

            });

            $('#forward2').click(function () {
                $("#priorty").prop('required', true);
                $("#category").prop('required', true);
                if ($('#statusfield').val() == "Resolved") {
                    $('#statuscheck').text("Set status either Open/Closed");
                    return false;
                }

            });
            $('#forward').click(function () {
                $("#priorty").prop('required', true);
                $("#category").prop('required', true);
                if ($('#statusfield').val() == "Resolved") {
                    $('#statuscheck').text("Set status either Open/Closed");
                return false;
               }
               
            });

            $('#resolve').click(function () {
                if ($('#statusfield').val() == "Resolved") {
                    $("#priorty").prop('required', false);
                    $("#category").prop('required', false);
                    return true;
                }

                else {
                    $('#statuscheck').text("Set status Resolved");
                    $("#priorty").prop('required', false);
                    $("#category").prop('required', false);
                    return false;

                }

            });

            $(function () {


                'use strict'

                // Toggles
                $('.toggle').toggles({
                    on: true,
                    height: 26
                });


                v// Input Masks
                $('#dateMask').mask('99/99/9999');
                $('#phoneMask').mask('(999) 999-9999');
                $('#ssnMask').mask('999-99-9999');

                // Time Picker
                $('#tpBasic').timepicker();
                $('#tp2').timepicker({
                    'scrollDefault': 'now'
                });
                $('#tp3').timepicker();

                $('#setTimeButton').on('click', function () {
                    $('#tp3').timepicker('setTime', new Date());
                });

                // Color picker
                $('#colorpicker').spectrum({
                    color: '#17A2B8'
                });

                $('#showAlpha').spectrum({
                    color: 'rgba(23,162,184,0.5)',
                    showAlpha: true
                });

                $('#showPaletteOnly').spectrum({
                    showPaletteOnly: true,
                    showPalette: true,
                    color: '#DC3545',
                    palette: [
                        ['#1D2939', '#fff', '#0866C6', '#23BF08', '#F49917'],
                        ['#DC3545', '#17A2B8', '#6610F2', '#fa1e81', '#72e7a6']
                    ]
                });

            });

            $(function () {
                'use strict'

                // Datepicker
                $('.fc-datepicker').datepicker({
                    showOtherMonths: true,
                    selectOtherMonths: true,
                    dateFormat: 'dd-mm-yy'
                });

                $('#datepickerNoOfMonths').datepicker({
                    showOtherMonths: true,
                    selectOtherMonths: true,
                    numberOfMonths: 2
                });

            });



             $("#deptId").change(function () {
                 $("#category option").remove();

                 $('#category').append('<option value=" ">' + "Choose Category" + '</option>');

                 $("#subcategory option").remove();

                 $('#subcategory').append('<option value=" ">' + "Choose Sub Category" + '</option>');
                $.ajax({
                    type: "POST",
                    url: "@Url.Action("getCategories", "HR")",
                    contentType: "application/json; charset=utf-8",
                    data: '{"depId":"' + $(this).val() + '"}',
                    dataType: "json",
                    success: function (r) {
                        
                        for (var i = 0; i < r.length; i++) {
                            $('#category').append('<option value="' + r[i].Id + '">' + r[i].name + '</option>'); 
                            
                        }
                    },
                    error: function (r) {
                        alert("error" + r.responseText);
                    }
                });

            });



             $("#category").change(function () {
                 $("#subcategory option").remove();

                 $('#subcategory').append('<option value=" ">' + "Choose Sub Category" + '</option>');
                $.ajax({
                    type: "POST",
                    url: "@Url.Action("getSubCategories", "HR")",
                    contentType: "application/json; charset=utf-8",
                    data: '{"categoryId":"' + $(this).val() + '"}',
                    dataType: "json",
                    success: function (r) {
                        
                        for (var i = 0; i < r.length; i++) {
                            $('#subcategory').append('<option value="' + r[i].Id + '">' + r[i].name + '</option>'); 
                            
                        }
                    },
                    error: function (r) {
                        alert("error" + r.responseText);
                    }
                });

            });

        </script>
</body>
</html>
